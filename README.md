# CryptoTradingBot


Binome : BOTTE Alexandre & CASANOVA Leo

<br/>Arbitrage

• Retrieve the asset list of an exchange A

• Retrieve the asset list of an exchange B

• Retrieve the bid and ask price for a select currency

• Compare bidA/askB and bidB/askA

• Scale the process to execute as close to real time as possible

• Receive an email notification when a match is found

<br/>CODE:

```
import numpy as np
import pandas as pd

import binance
from poloniex import Poloniex

import sched, time

import datetime

import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText


binance.set("API Key", "Secret Key")

polo = Poloniex()

s = sched.scheduler(time.time, time.sleep)


def SendNotif(comp1, comp2):
    if (comp1 == True or comp2 == True):
        fromaddr = "MYEMAIL.com"
        toaddr = "YOUREMAIL.com"
        msg = MIMEMultipart()
        msg['From'] = fromaddr
        msg['To'] = toaddr
        msg['Subject'] = "Notification for crypto LTC"
        
        if (comp1 == True and comp2 == True):
            body = "Bid (Binance) > Ask (Poloniex) AND Bid (Poloniex) > Ask (Binance)"
        elif (comp1 == True):
            body = "Bid (Binance) > Ask (Poloniex)"
        else:
            body = "Bid (Poloniex) > Ask (Binance)"
            
        msg.attach(MIMEText(body, 'plain'))
 
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls()
        server.login(fromaddr, "MYPASSWORD")
        text = msg.as_string()
        server.sendmail(fromaddr, toaddr, text)
        server.quit()


def TradingBot(sc): 

    print ("Analyzing the market...")
    print('Timestamp: {:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now()))
    print()
    
    #-------------------------------------------------------
    #Retrieve the asset list of an exchange A
    print("---------------------------------------------------------------------------")
    print()
    print("Retrieving asset list from Binance")
    pricesA = binance.tickers()
    ExA = pd.DataFrame(pricesA).transpose()
    print(ExA.head(5))  
    print("...")
    #-------------------------------------------------------
    #Retrieve the asset list of an exchange B
    print("---------------------------------------------------------------------------")
    print()
    print("Retrieving asset list from Poloniex")
    pricesB = dict(polo.returnTicker())
    ExB = pd.DataFrame.from_dict(pricesB, orient = 'index')
    print(ExB.head(5))
    print("...")
    #-------------------------------------------------------
    
    #-------------------------------------------------------
    #Retrieve the bid and ask price for a select currency
    print("---------------------------------------------------------------------------")
    print()
    print("Retrieving bid and ask price for LTC from Binance")
    LTC_A = ExA.loc['LTCBTC']
    print(LTC_A)
    print()
    
    print("---------------------------------------------------------------------------")
    print()
    print("Retrieving bid and ask price for LTC from Binance")
    LTC_B = ExB.loc['BTC_LTC']
    print(LTC_B)
    print()
    #-------------------------------------------------------
    
    #-------------------------------------------------------
    #Compare bidA/askB and bidB/askA
    print("---------------------------------------------------------------------------")
    print()
    print("Exchange A : Binance")
    print("Exchange B : Poloniex")
    print()
    print("Comparing bidA/askB and bidB/askA")
    print()
    A = (float(LTC_A['bid']), float(LTC_A['ask']))
    B = (LTC_B['highestBid'], LTC_B['lowestAsk'])
    
    A = np.array(A)
    B = np.array(B)
    
    Comp = pd.DataFrame([A,B], index = 'A B'.split(), columns = 'Bid Ask'.split())
    print(Comp)
    
    Comp1 = Comp['Bid']['A'] > Comp['Ask']['B']
    Comp2 = Comp['Bid']['B'] > Comp['Ask']['A']
    
    print()
    print("Bid A > Ask B : {}".format(Comp1))
    print("Bid B > Ask A : {}".format(Comp2))
    print()
    #-------------------------------------------------------
    
    #-------------------------------------------------------
    #Send Email Notification
    SendNotif(Comp1, Comp2)
    #-------------------------------------------------------
    
    s.enter(60, 1, TradingBot, (sc,))


s.enter(60, 1, TradingBot, (s,))
s.run()
```

<br/>Example output:

```
Analyzing the market...
Timestamp: 2019-01-27 15:55:00

---------------------------------------------------------------------------

Retrieving asset list from Binance
                ask        askQty         bid        bidQty
ETHBTC   0.03188100    1.17900000  0.03186600    0.47000000
LTCBTC   0.00904400   10.01000000  0.00904300    0.55000000
BNBBTC   0.00194450   18.13000000  0.00194390  243.18000000
NEOBTC   0.00205900  152.51000000  0.00205600  171.82000000
QTUMETH  0.01767800    3.33000000  0.01760800    1.14000000
...
---------------------------------------------------------------------------

Retrieving asset list from Poloniex
           baseVolume      high24hr    highestBid  id  isFrozen          last  \
BTC_BCN     10.122873  1.800000e-07  1.600000e-07   7         0  1.700000e-07   
BTC_BTS      5.809302  1.104000e-05  1.058000e-05  14         0  1.062000e-05   
BTC_BURST    1.850178  1.050000e-06  1.030000e-06  15         0  1.040000e-06   
BTC_CLAM     1.631277  5.021800e-04  4.637900e-04  20         0  4.638000e-04   
BTC_DASH    16.171443  2.054928e-02  1.976216e-02  24         0  1.976211e-02   

                low24hr     lowestAsk  percentChange   quoteVolume  
BTC_BCN    1.600000e-07  1.700000e-07       0.000000  5.968522e+07  
BTC_BTS    1.057000e-05  1.064000e-05      -0.003752  5.414385e+05  
BTC_BURST  1.030000e-06  1.040000e-06       0.000000  1.774618e+06  
BTC_CLAM   4.606700e-04  4.638000e-04      -0.035358  3.464030e+03  
BTC_DASH   1.975000e-02  1.986689e-02      -0.028707  8.012413e+02  
...
---------------------------------------------------------------------------

Retrieving bid and ask price for LTC from Binance
ask        0.00904400
askQty    10.01000000
bid        0.00904300
bidQty     0.55000000
Name: LTCBTC, dtype: object

---------------------------------------------------------------------------

Retrieving bid and ask price for LTC from Binance
baseVolume         157.532204
high24hr             0.009340
highestBid           0.009064
id                  50.000000
isFrozen             0.000000
last                 0.009064
low24hr              0.008996
lowestAsk            0.009065
percentChange       -0.028015
quoteVolume      17184.635085
Name: BTC_LTC, dtype: float64

---------------------------------------------------------------------------

Exchange A : Binance
Exchange B : Poloniex

Comparing bidA/askB and bidB/askA

        Bid       Ask
A  0.009043  0.009044
B  0.009064  0.009065

Bid A > Ask B : False
Bid B > Ask A : True
```

![github](https://user-images.githubusercontent.com/47087905/51808013-ab879280-228e-11e9-9417-d2ee11503d05.jpg)


<br/>Data analysis

• Retrieve historical data on exchange A

• Time resolution: 5mn

• Store it in local database

• Calculate 20SMA, 50EMA

• Parametrize the function to calculate XSMA or Y-EMA

• Calculate MACD and RSI

<br/>CODE:

```
import numpy as np
import pandas as pd

import binance

import datetime
from datetime import datetime

pd.options.mode.chained_assignment = None


d_init = datetime.strptime('01.01.2019 00:00:00','%d.%m.%Y %H:%M:%S')
d_init_millisec = d_init.timestamp() * 1000
print()
print(d_init_millisec)

d_final = datetime.strptime('27.01.2019 00:00:00','%d.%m.%Y %H:%M:%S')
d_final_millisec = d_final.timestamp() * 1000

print()
print(d_final_millisec)

#histA = binance.klines('LTCBTC','5m', limit = 500, startTime = d_init_millisec, endTime = d_final_millisec)

histA = binance.klines('LTCBTC', '5m', limit = 50)

df_histA = pd.DataFrame(histA)

print()
print()
print(df_histA)

df = df_histA[['closeTime','close']]
df.index = np.arange(1,len(df)+1)

Df = df.copy()

Df['close'] = Df['close'].astype(float)
Df['SMA'] = np.nan

print()
print()
print(Df)


def Mean(df, i):
    mean = df.loc[i:i+19]['close']
    return mean.mean()


def SMA(df):
    for i in range(1, len(df)-18):
        df.at[i+19,'SMA'] = Mean(df, i)
        
        
SMA(Df)

print()
print()
print(Df)
```

<br/> Output:

```
1546297200000.0

1548543600000.0


         close      closeTime        high         low  numTrades        open  \
0   0.00919300  1548614399999  0.00920000  0.00919000        143  0.00919400   
1   0.00918500  1548614699999  0.00919600  0.00918500         99  0.00919200   
2   0.00918700  1548614999999  0.00919100  0.00917900         73  0.00918700   
3   0.00916700  1548615299999  0.00919300  0.00916000        129  0.00918700   
4   0.00916700  1548615599999  0.00916800  0.00916000         50  0.00916100   
5   0.00916900  1548615899999  0.00917800  0.00916700         49  0.00916800   
6   0.00917200  1548616199999  0.00917900  0.00916000         56  0.00917000   
7   0.00916900  1548616499999  0.00917000  0.00916200         40  0.00916300   
8   0.00916700  1548616799999  0.00917300  0.00916300         51  0.00916900   
9   0.00917000  1548617099999  0.00917500  0.00916200         57  0.00917200   
10  0.00917000  1548617399999  0.00917400  0.00917000         24  0.00917000   
11  0.00917000  1548617699999  0.00917000  0.00916500         34  0.00916500   
12  0.00914800  1548617999999  0.00916900  0.00914100         75  0.00916700   
13  0.00914700  1548618299999  0.00914700  0.00914200        102  0.00914700   
14  0.00915900  1548618599999  0.00916000  0.00914600         47  0.00914700   
15  0.00915100  1548618899999  0.00916000  0.00915000         50  0.00916000   
16  0.00914400  1548619199999  0.00916100  0.00914100         61  0.00915200   
17  0.00917100  1548619499999  0.00917700  0.00914500        295  0.00914500   
18  0.00917700  1548619799999  0.00918300  0.00916900         50  0.00917100   
19  0.00916900  1548620099999  0.00917900  0.00916000         60  0.00917600   
20  0.00916200  1548620399999  0.00917200  0.00915500         49  0.00916900   
21  0.00915800  1548620699999  0.00916300  0.00915600         41  0.00915800   
22  0.00916000  1548620999999  0.00916200  0.00914600         51  0.00915500   
23  0.00916000  1548621299999  0.00916300  0.00915100         51  0.00915400   
24  0.00916000  1548621599999  0.00916500  0.00915400         50  0.00916000   
25  0.00915800  1548621899999  0.00916100  0.00915000         39  0.00916000   
26  0.00916000  1548622199999  0.00916200  0.00915900         35  0.00916000   
27  0.00916300  1548622499999  0.00916600  0.00915900         34  0.00916000   
28  0.00916600  1548622799999  0.00916900  0.00916200         63  0.00916400   
29  0.00916800  1548623099999  0.00918300  0.00916100         69  0.00916700   
30  0.00918000  1548623399999  0.00918200  0.00916500         37  0.00917200   
31  0.00917000  1548623699999  0.00918200  0.00916400         38  0.00917900   
32  0.00917100  1548623999999  0.00917600  0.00916600         55  0.00917100   
33  0.00916000  1548624299999  0.00917100  0.00916000         51  0.00917100   
34  0.00916000  1548624599999  0.00918000  0.00916000         53  0.00916300   
35  0.00919500  1548624899999  0.00922500  0.00915500        174  0.00916400   
36  0.00918400  1548625199999  0.00921500  0.00917600         74  0.00919500   
37  0.00918600  1548625499999  0.00919400  0.00917900         45  0.00918600   
38  0.00918800  1548625799999  0.00920900  0.00918100         62  0.00918800   
39  0.00917200  1548626099999  0.00918700  0.00917200         50  0.00918100   
40  0.00918200  1548626399999  0.00919000  0.00917300         49  0.00917300   
41  0.00918400  1548626699999  0.00919200  0.00917800         64  0.00918200   
42  0.00918100  1548626999999  0.00918800  0.00918000         47  0.00918700   
43  0.00918900  1548627299999  0.00919000  0.00918000         51  0.00918100   
44  0.00917100  1548627599999  0.00918700  0.00916800         49  0.00918400   
45  0.00913400  1548627899999  0.00917200  0.00913300        118  0.00916900   
46  0.00913500  1548628199999  0.00914200  0.00913300        142  0.00914000   
47  0.00913800  1548628499999  0.00915200  0.00913200         91  0.00913800   
48  0.00915400  1548628799999  0.00915400  0.00913800         42  0.00913800   
49  0.00915100  1548629099999  0.00915500  0.00914900          4  0.00915500   

         openTime  quoteVolume         volume  
0   1548614100000   5.08884494   553.41000000  
1   1548614400000   3.38405327   368.19000000  
2   1548614700000   3.82762691   416.69000000  
3   1548615000000   6.45788910   703.46000000  
4   1548615300000   1.59596408   174.18000000  
5   1548615600000   2.54308338   277.25000000  
6   1548615900000   1.87256216   204.28000000  
7   1548616200000   1.81378495   197.93000000  
8   1548616500000   1.57290916   171.55000000  
9   1548616800000   1.44352486   157.44000000  
10  1548617100000   0.48258366    52.62000000  
11  1548617400000   1.06875709   116.59000000  
12  1548617700000   3.65302352   399.02000000  
13  1548618000000   4.36268446   477.08000000  
14  1548618300000   3.12639828   341.65000000  
15  1548618600000   1.99272452   217.64000000  
16  1548618900000   2.31764771   253.37000000  
17  1548619200000   6.85072804   748.13000000  
18  1548619500000   1.48888420   162.25000000  
19  1548619800000   2.44686679   266.78000000  
20  1548620100000   0.96002698   104.75000000  
21  1548620400000   1.29848334   141.78000000  
22  1548620700000   3.82845099   418.42000000  
23  1548621000000   1.25446182   136.99000000  
24  1548621300000   1.14859713   125.41000000  
25  1548621600000   1.10416619   120.58000000  
26  1548621900000   0.57882277    63.19000000  
27  1548622200000   1.12914479   123.24000000  
28  1548622500000   1.64000504   178.92000000  
29  1548622800000   2.81790483   307.28000000  
30  1548623100000   1.19709441   130.52000000  
31  1548623400000   0.99806200   108.81000000  
32  1548623700000   0.99213969   108.18000000  
33  1548624000000   1.73952920   189.79000000  
34  1548624300000   2.87219299   313.30000000  
35  1548624600000  10.95888531  1192.64000000  
36  1548624900000   3.09867906   336.79000000  
37  1548625200000   2.54002977   276.50000000  
38  1548625500000   1.38359080   150.56000000  
39  1548625800000   2.32437218   253.26000000  
40  1548626100000   2.06067739   224.45000000  
41  1548626400000   1.65740681   180.46000000  
42  1548626700000   2.40415328   261.77000000  
43  1548627000000   2.13453955   232.37000000  
44  1548627300000   3.16332145   344.76000000  
45  1548627600000   5.82733173   636.56000000  
46  1548627900000   5.47596943   599.36000000  
47  1548628200000   4.38589823   480.01000000  
48  1548628500000   3.19141052   348.77000000  
49  1548628800000   0.07605021     8.31000000  


        closeTime     close  SMA
1   1548614399999  0.009193  NaN
2   1548614699999  0.009185  NaN
3   1548614999999  0.009187  NaN
4   1548615299999  0.009167  NaN
5   1548615599999  0.009167  NaN
6   1548615899999  0.009169  NaN
7   1548616199999  0.009172  NaN
8   1548616499999  0.009169  NaN
9   1548616799999  0.009167  NaN
10  1548617099999  0.009170  NaN
11  1548617399999  0.009170  NaN
12  1548617699999  0.009170  NaN
13  1548617999999  0.009148  NaN
14  1548618299999  0.009147  NaN
15  1548618599999  0.009159  NaN
16  1548618899999  0.009151  NaN
17  1548619199999  0.009144  NaN
18  1548619499999  0.009171  NaN
19  1548619799999  0.009177  NaN
20  1548620099999  0.009169  NaN
21  1548620399999  0.009162  NaN
22  1548620699999  0.009158  NaN
23  1548620999999  0.009160  NaN
24  1548621299999  0.009160  NaN
25  1548621599999  0.009160  NaN
26  1548621899999  0.009158  NaN
27  1548622199999  0.009160  NaN
28  1548622499999  0.009163  NaN
29  1548622799999  0.009166  NaN
30  1548623099999  0.009168  NaN
31  1548623399999  0.009180  NaN
32  1548623699999  0.009170  NaN
33  1548623999999  0.009171  NaN
34  1548624299999  0.009160  NaN
35  1548624599999  0.009160  NaN
36  1548624899999  0.009195  NaN
37  1548625199999  0.009184  NaN
38  1548625499999  0.009186  NaN
39  1548625799999  0.009188  NaN
40  1548626099999  0.009172  NaN
41  1548626399999  0.009182  NaN
42  1548626699999  0.009184  NaN
43  1548626999999  0.009181  NaN
44  1548627299999  0.009189  NaN
45  1548627599999  0.009171  NaN
46  1548627899999  0.009134  NaN
47  1548628199999  0.009135  NaN
48  1548628499999  0.009138  NaN
49  1548628799999  0.009154  NaN
50  1548629099999  0.009151  NaN


        closeTime     close       SMA
1   1548614399999  0.009193       NaN
2   1548614699999  0.009185       NaN
3   1548614999999  0.009187       NaN
4   1548615299999  0.009167       NaN
5   1548615599999  0.009167       NaN
6   1548615899999  0.009169       NaN
7   1548616199999  0.009172       NaN
8   1548616499999  0.009169       NaN
9   1548616799999  0.009167       NaN
10  1548617099999  0.009170       NaN
11  1548617399999  0.009170       NaN
12  1548617699999  0.009170       NaN
13  1548617999999  0.009148       NaN
14  1548618299999  0.009147       NaN
15  1548618599999  0.009159       NaN
16  1548618899999  0.009151       NaN
17  1548619199999  0.009144       NaN
18  1548619499999  0.009171       NaN
19  1548619799999  0.009177       NaN
20  1548620099999  0.009169  0.009168
21  1548620399999  0.009162  0.009166
22  1548620699999  0.009158  0.009165
23  1548620999999  0.009160  0.009163
24  1548621299999  0.009160  0.009163
25  1548621599999  0.009160  0.009163
26  1548621899999  0.009158  0.009162
27  1548622199999  0.009160  0.009161
28  1548622499999  0.009163  0.009161
29  1548622799999  0.009166  0.009161
30  1548623099999  0.009168  0.009161
31  1548623399999  0.009180  0.009162
32  1548623699999  0.009170  0.009162
33  1548623999999  0.009171  0.009163
34  1548624299999  0.009160  0.009163
35  1548624599999  0.009160  0.009163
36  1548624899999  0.009195  0.009166
37  1548625199999  0.009184  0.009168
38  1548625499999  0.009186  0.009168
39  1548625799999  0.009188  0.009169
40  1548626099999  0.009172  0.009169
41  1548626399999  0.009182  0.009170
42  1548626699999  0.009184  0.009171
43  1548626999999  0.009181  0.009172
44  1548627299999  0.009189  0.009174
45  1548627599999  0.009171  0.009174
46  1548627899999  0.009134  0.009173
47  1548628199999  0.009135  0.009172
48  1548628499999  0.009138  0.009171
49  1548628799999  0.009154  0.009170
50  1548629099999  0.009151  0.009169
```
